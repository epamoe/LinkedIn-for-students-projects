{% extends 'base.html' %}
{% load static %}
{% block title %} FindIvest | Accueil {% endblock %}


{% block content %}


{% if user.is_authenticated %}
      <h1> Bienvenue<u>{{request.user.last_name}}</u></h1>
      {% if user.etudiant.id %}
        <a href="{% url 'update_profile_student' request.user.etudiant.id %}">Modifier profil Etudiant</a> 
          {{request.user.etudiant.photoProfil.url}}
      <br>
          <a href="{% url 'profile_student' request.user.etudiant.id %}">Profil etudiant</a>
          <br>
      {% endif %}
      {% if user.investisseur.id %}
          <a href="{% url 'update_profile_investor' request.user.investisseur.id %}">Modifier profil Investisseur</a> 
          {{request.user.investisseur.photoProfil.url}}
          <br><br>
      {% endif %}

      <a href="{% url 'user_logout' %}">se d√©connecter</a>
{% endif %} 


<style>
body {font-family: Arial, Helvetica, sans-serif;}

/* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding-top: 100px; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
  background-color: #fefefe;
  margin: auto;
  border: 1px solid #888;
  width: 540px;
  height: 85%;
}

/* le bouton x de fermeture du modal */
.close {
  color: #aaaaaa;
  font-size: 28px;
  font-weight: bold;
  float: right;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}

/* gestion du formulaire */
.form{
    position: absolute;
    background: #f2f2f2;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    
    transition: .3s ease-in-out;
    overflow: hidden;
    border-radius: 10px;
  }
    
    .form .form-group{
      
      margin-left: 20%;
    }
    #id_title, #id_categorie, #id_description{
      width: 150px;
    /* margin-bottom: 20px; */
      padding: 10px;
      height: 55px;
      width: 350px;
      border-radius: 0 !important;
      font-size: 16px;
      box-shadow: none;
      /* border: #333 solid 1px; */
      border-top: none !important;
      border-left: none !important;
      border-right: none !important;
    }

    #id_title: focus, #id_categorie: focus, #id_description: focus{
      border-bottom: #0b5ed7 solid 1px !important
    }
    /* gestion des bouton */
    .btn1,
    .btn2{
      margin-top: 20px;
      display: flex;
      width: 150px;
      height: 50px 
      font-size: 1.5rem;
      padding: 5px 20px;
      border-radius: 0;
      }
    .form-group textarea{
      margin-top: 10px;
      height: 150px;
      min-height: 150px;
      max-height: 170px;
      width: 350px;
    }
    .btn1{
      background: #1b65d5d9;
    }
    .btn2{
      background: orange;
      float: right;
      margin-top: -48px;
    }
    .bloc{
            border-radius: 10px;
            border: #ced4da solid 1px;
            padding: 15px 15px 20px;
          }

    @media screen and (max-width: 992px){
      .modal-content{
        width: 440px;
        height: 80%;
      }
    }
</style>

<br>
<!-- button qui ouvre le modal -->
<button id="myBtn" class="btn btn-primary">publier</button>

<!-- la div  Modal -->
<div id="myModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">
    
    <div class="form">
      <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
          <span class="close">&times;</span>
          <h2 style="text-align: center; margin-left: 40px; margin-top: 10px;">Cr&eacuteer une publication</h2>
          <span class="bloc mt-4" id="block">
          <div class="form-group">
              {{ projet_form.title }}
              <p><span class="errorform" id="error_title"></span></p>
            </div>
            <div class="form-group">
              <label>categorie</label>
              {{ projet_form.categorie }}
              <p><span class="errorform" id="error_categorie"></span></p>
            </div>
            <div class="form-group">
              {{ projet_form.image }}
            </div>
            <div class="form-group">
              <textarea name="description" cols="40" rows="10" maxlength="500" placeholder="Decrivez votre  projet en quelques lignes" required="" id="id_description"></textarea>
              <p><span class="errorform" id="error_description"></span></p>
            </div>
                    <div class="form-group">
                        <select name="etudiant" style="display: none;" required="" id="id_etudiant">

                            <option value="{{ request.user.etudiant.id }}">{{ request.user.etudiant }}</option>

                        </select>
            </div>
                
            <div class="form-group">
              <button type="submit" class="btn1" onclick="validatePost()">publier</button>
                        {{ err }}
              <span class="btn2">annuler</span> 
          </div>
          </span>
      
      </form>
    </div>
  </div>

</div>

 <div style="margin: 5% 10%;">
    {% for projet in list_projet %}
        {% if not projet.image.url %}
          <p style="margin-bottom: -3px;">titre: {{ projet.title }}</p>
        {% else %}
          <p style="margin-bottom: -3px;">titre: {{ projet.title }}</p>
          <img src="{{ projet.image.url }}" width="200" height="200"><br>
        {% endif %}
        <sup style="margin-top: 8px;">publier le {{ projet.date_post }}</sup><br>

        <a class="btn btn-danger" href="{% url 'delete' projet.id %}"> supprimer</a>
        <a class="btn btn-secondary" href="{% url 'update' projet.id %}">modifier </a>
    {% endfor %}
</div>
<script>
// obtenir le modal
var modal = document.getElementById("myModal");

// obtnenir le bouton qui ouvre le modal
var btn = document.getElementById("myBtn");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];
var btn2 = document.getElementsByClassName("btn2")[0]

// quand l'utilisateur click sur le bouton le modal s'ouvre 
btn.onclick = function() {
  modal.style.display = "block";

}


// quans l'utilisateur clic sur le span x ou sur annuler le modals se ferme
span.onclick = function() {
  modal.style.display = "none";
}
btn2.onclick = function(){
  modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}

// champs placeholder
champsForm = document.getElementsByTagName('input');
champsForm[1].placeholder=" Titre";
champsForm[2].placeholder="Categorie";
champsForm[3].placeholder="Description";


var id_title = document.getElementById('id_title')
var error_title = document.getElementById('error_title')

var id_categorie = document.getElementById('id_categorie')
var error_categorie = document.getElementById('error_categorie')

var id_description = document.getElementById('id_description')
var error_description = document.getElementById('error_description')


function valChapmsText(champs, errClass) {
    if (champs.value == "") {
    errClass.innerHTML="*veuillez remplir ce champs";
    champs.focus();
    champs.classList.add('err');
    return false;
    } else {
    errClass.innerHTML="";
    champs.classList.remove('err');
    return true;
    }
}

function validatePost() {

  // body...
  if (valChapmsText(id_title, error_title)
    && valChapmsText(id_categorie, error_categorie)
    && valChapmsText(id_description, error_description)
    ){
    return true;
  }
  else{
    return false;
  }
}

</script>
{% endblock %}


